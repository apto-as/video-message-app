# ユーザーガイド - 新機能説明

このドキュメントでは、Video Message Appの新機能について、ユーザー向けに分かりやすく説明します。

---

## 📋 目次
1. [人物抽出 - 透明パディング調整機能](#人物抽出---透明パディング調整機能)
2. [音声品質 - ボイスコントロール機能](#音声品質---ボイスコントロール機能)

---

## 人物抽出 - 透明パディング調整機能

**実装日**: 2024年12月7日
**機能概要**: 抽出した人物画像の周りに透明な余白を追加できます

### 📸 この機能でできること

写真から人物を抽出する際、人物の周囲に透明な余白（パディング）を追加できます。これにより、動画生成時により自然な仕上がりになります。

### 🎯 使い方

1. **画像をアップロード**
   - 「クリックまたはドラッグ&ドロップで画像を選択」エリアに写真をアップロード
   - JPEG、PNG形式に対応

2. **人物を検出**
   - 「人物を検出」ボタンをクリック
   - 検出された人物が緑色の枠で表示されます

3. **パディング設定を調整**

   **方法1: 標準設定（推奨）**
   - ☑️ 「透明パディングを追加」のチェックを入れたまま
   - スライダーを調整: **300px（デフォルト）**

   **方法2: カスタム調整**
   - スライダーを左右に動かして好みのサイズに調整
   - 範囲: 0px（余白なし） 〜 500px（大きめの余白）
   - 50pxずつ調整可能

   **方法3: パディングなし**
   - ☐ 「透明パディングを追加」のチェックを外す
   - 人物を最小限の余白で抽出

4. **人物を選択して抽出**
   - 残したい人物をクリックして選択（複数選択可能）
   - 「選択した人物を抽出」ボタンをクリック
   - 抽出結果が表示されます

5. **ダウンロード**
   - 「ダウンロード (PNG)」ボタンで保存
   - 透明背景のPNG形式で保存されます

### 💡 パディングサイズの目安

| 用途 | 推奨サイズ | 理由 |
|-----|----------|------|
| **動画生成（D-ID）** | **300px** | アバターが自然に動く余地を確保 |
| プロフィール写真 | 100px | 顔を中心に配置、コンパクト |
| 全身動画 | 400-500px | 体の動きを考慮した広めの余白 |
| ぴったり切り取り | 0px（チェックOFF） | 人物のみを正確に切り取り |

### 🎬 なぜパディングが必要？

**D-ID動画生成での効果**:
- ✅ アバターの動きが自然になる（顔が画面端に寄らない）
- ✅ 顔認識が正確になる（十分な余白で顔検出が安定）
- ✅ 動画の見栄えが向上（プロフェッショナルな仕上がり）

**パディングなしの場合**:
- ❌ 顔が画面端に寄りすぎて不自然
- ❌ 動きが制限される（余白がないため）
- ❌ 一部が切れる可能性

### ⚙️ 技術的な仕組み

1. 元の画像から人物のバウンディングボックス（矩形）を検出
2. 指定したパディングサイズ分、矩形を拡張
3. 拡張した領域に透明な余白を追加
4. PNG形式（透明度対応）で出力

---

## 音声品質 - ボイスコントロール機能

**実装日**: 2024年12月7日
**機能概要**: 音声のピッチ、ボリューム、抑揚を細かく調整できます

### 🎤 この機能でできること

VOICEVOX、OpenVoiceで生成する音声の品質を、以下のパラメータで調整できます:

- **イントネーション（抑揚）** - 感情の起伏を調整（VOICEVOX）
- **ピッチ（音程）** - 声の高さを調整（OpenVoice）
- **ボリューム（音量）** - 声の大きさを調整（両方）

### 🎯 使い方

#### VOICEVOX音声の調整

1. **音声選択**
   - VOICEVOXタブで好きな話者を選択（例: ずんだもん、四国めたん）

2. **速度調整**
   - スライダーで話す速さを調整
   - 範囲: 0.5倍速（ゆっくり） 〜 2.0倍速（速い）
   - デフォルト: 1.0倍速

3. **イントネーション調整** ⭐ 新機能
   - スライダーで抑揚の強さを調整
   - 範囲: 0.0（無感情） 〜 2.0（とても感情豊か）
   - デフォルト: 1.0（標準）

4. **ボリューム調整** ⭐ 新機能
   - スライダーで音量を調整
   - 範囲: 0.0（無音） 〜 2.0（最大）
   - デフォルト: 1.0（標準音量）

#### OpenVoice音声の調整

1. **音声選択**
   - OpenVoiceタブでクローン音声を選択

2. **速度調整**
   - VOICEVOXと同様（0.5倍速 〜 2.0倍速）

3. **ピッチ調整** ⭐ 新機能
   - スライダーで声の高さを調整
   - 範囲: -0.15（低い声） 〜 +0.15（高い声）
   - デフォルト: 0.0（元の声）

4. **ボリューム調整** ⭐ 新機能
   - スライダーで音量を調整
   - VOICEVOXと同様（0.0 〜 2.0）

### 💡 パラメータ設定の目安

#### イントネーション（VOICEVOX）

| 値 | 効果 | 用途 |
|---|------|------|
| **0.5** | 平坦で無感情な話し方 | ニュース読み上げ、事務的な案内 |
| **1.0** | 自然な話し方（デフォルト） | 一般的な用途、日常会話 |
| **1.5** | 感情豊かな話し方 | 物語の朗読、エンターテイメント |
| **2.0** | 非常に感情的な話し方 | ドラマチックな演技、演劇風 |

#### ピッチ（OpenVoice）

| 値 | 効果 | 用途 |
|---|------|------|
| **-0.10** | 低めの声（男性的） | 落ち着いた雰囲気、威厳のある声 |
| **0.0** | 元の声（デフォルト） | 自然なクローン音声 |
| **+0.10** | 高めの声（女性的） | 明るい雰囲気、若々しい声 |

#### ボリューム（両方）

| 値 | 効果 | 用途 |
|---|------|------|
| **0.5** | 静かな声 | ASMR、ささやき声 |
| **1.0** | 標準音量（デフォルト） | 一般的な用途 |
| **1.5** | 大きめの声 | プレゼンテーション、アナウンス |

### 🎬 実用例

#### 例1: 感情的なメッセージ動画
```
VOICEVOX設定:
- 話者: 四国めたん
- イントネーション: 1.5（感情豊か）
- ボリューム: 1.2（少し大きめ）
→ 感動的なメッセージに最適
```

#### 例2: 落ち着いたナレーション
```
OpenVoice設定:
- ピッチ: -0.05（少し低め）
- ボリューム: 1.0（標準）
→ ドキュメンタリー風のナレーション
```

#### 例3: 明るいキャラクター
```
VOICEVOX設定:
- 話者: ずんだもん
- イントネーション: 1.8（とても感情豊か）
- ボリューム: 1.3（元気な声）
→ アニメ風のキャラクターボイス
```

### ⚙️ 技術的な仕組み

#### VOICEVOX
- **イントネーション**: VOICEVOX Engine APIの `intonation_scale` パラメータを使用
- 内部的にアクセントの強弱を調整

#### OpenVoice
- **ピッチ調整**: FFmpegの `asetrate` フィルタでサンプルレートを変更
  - 例: `asetrate=44100*1.05` → 5%ピッチアップ
- **ボリューム調整**: FFmpegの `volume` フィルタで音量を調整
  - 例: `volume=1.5` → 50%音量アップ

### 🔧 トラブルシューティング

#### 音声が途切れる・ノイズが入る
- **原因**: パラメータの極端な設定
- **解決策**:
  - ピッチは ±0.1 以内に抑える
  - ボリュームは 0.5 〜 1.5 の範囲を推奨

#### 音声が不自然
- **原因**: イントネーションが高すぎる/低すぎる
- **解決策**:
  - まず 1.0（デフォルト）から始める
  - 0.2刻みで少しずつ調整

#### 音量が小さすぎる/大きすぎる
- **原因**: ボリューム設定が不適切
- **解決策**:
  - D-ID動画では 1.0 〜 1.2 を推奨
  - 音量調整は最後に行う（ピッチ調整後）

---

## 📞 サポート

ご不明な点がございましたら、プロジェクトドキュメントをご確認ください:
- **技術詳細**: `docs/IMPLEMENTATION_NOTES.md`
- **変更履歴**: `CHANGELOG.md`
- **プロジェクト全体**: `CLAUDE.md`

---

**ドキュメントバージョン**: 1.0
**最終更新**: 2024年12月7日
**対象バージョン**: Video Message App (latest)
